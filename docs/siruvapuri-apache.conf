<VirtualHost *:80>
    ServerName siruvapuri.webexcel.in

    # Redirect HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName siruvapuri.webexcel.in
    ServerAdmin webmaster@webexcel.in

    # SSL Configuration (managed by Certbot)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/siruvapuri.webexcel.in/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/siruvapuri.webexcel.in/privkey.pem

    # Enable required modules
    RewriteEngine On
    ProxyPreserveHost On
    ProxyRequests Off

    # API requests -> Node.js container (port 5000)
    ProxyPass /api http://localhost:5000/api
    ProxyPassReverse /api http://localhost:5000/api

    # All other requests -> Client container (port 3000)
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/siruvapuri_error.log
    CustomLog ${APACHE_LOG_DIR}/siruvapuri_access.log combined
</VirtualHost>

# Admin Panel - Separate subdomain (optional)
# If you want admin on admin.siruvapuri.webexcel.in, uncomment below:

# <VirtualHost *:80>
#     ServerName admin.siruvapuri.webexcel.in
#     RewriteEngine On
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </VirtualHost>

# <VirtualHost *:443>
#     ServerName admin.siruvapuri.webexcel.in
#
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/admin.siruvapuri.webexcel.in/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/admin.siruvapuri.webexcel.in/privkey.pem
#
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     # API requests
#     ProxyPass /api http://localhost:5000/api
#     ProxyPassReverse /api http://localhost:5000/api
#
#     # Admin panel
#     ProxyPass / http://localhost:3001/
#     ProxyPassReverse / http://localhost:3001/
#
#     ErrorLog ${APACHE_LOG_DIR}/siruvapuri_admin_error.log
#     CustomLog ${APACHE_LOG_DIR}/siruvapuri_admin_access.log combined
# </VirtualHost>
